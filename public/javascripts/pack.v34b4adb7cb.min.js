if(null==versionNumber)var versionNumber=(new Date).getTime();function clicChildren(){$("#searchForm .rooms > div").each(function(t){var a=parseInt(t+1);for(children=$("#children_"+a).val(),e=1;e<=3;e++)id="age_"+e+"_"+a,$el=$("select#"+id).attr("name"),e<=children?$("select#"+id).parent().show():$("select#"+id).parent().hide();$("#searchForm select[id^='age_']").each(function(e){$f=$(this).attr("data-fv-field"),$f&&0!=$f&&(console.log("remove field"+$f),$("#searchForm").formValidation("removeField",$f))}),$("#searchForm select[id^='age_']:visible").each(function(e){$n=$(this).attr("name"),$("#searchForm").formValidation("addField",$n,{validators:{notEmpty:{message:"Obligatoire!"}}}),console.log("add formvalidation to : "+$n)})})}function countGuest(){var a=0,r=0,n=0,e=$('input[name="rooms"]').val();$("#searchForm .adultshotel").each(function(e,t){a+=parseInt($(this).val())}),$("#searchForm .childrenhotel").each(function(e,t){r+=parseInt($(this).val())}),$("#searchForm .infantshotel").each(function(e,t){n+=parseInt($(this).val())}),$("#searchForm .guests-select .valRoomstshotel").html(e),$("#searchForm .guests-select .valAdultshotel").html(a),0<r?$("#searchForm .guests-select .valChildrenhotel").html(", "+r):$("#searchForm .guests-select .valChildrenhotel").html(""),0<n?$("#searchForm .guests-select .valInfantshotel").html(", "+n):$("#searchForm .guests-select .valInfantshotel").html(""),1==e?$("#searchForm .guests-select .txt-room").html("chambre"):$("#searchForm .guests-select .txt-room").html("chambres"),1<a?$("#searchForm .guests-select .txt-adt").html("adultes"):$("#searchForm .guests-select .txt-adt").html("adulte"),1<r?$("#searchForm .guests-select .txt-enf").html("enfants"):0==r?$("#searchForm .guests-select .txt-enf").html(""):$("#searchForm .guests-select .txt-enf").html("enfant"),1<n?$("#searchForm .guests-select .txt-beb").html("b&eacute;b&eacute;s"):0==n?$("#searchForm .guests-select .txt-beb").html(""):$("#searchForm .guests-select .txt-beb").html("b&eacute;b&eacute;")}function delRoom(){$("#searchForm select[id^='age_']").each(function(e){$f=$(this).attr("data-fv-field"),$f&&0!=$f&&(console.log("remove field"+$f),$("#searchForm").formValidation("removeField",$f))}),$("#searchForm .rooms > div").each(function(a){$(this).find("div:eq(0) label").html("Chambre "+parseInt(a+1)),$(this).find("button").each(function(){$(this).attr({"data-field":function(e,t){return Left(t,t.length-1)+parseInt(a+1)}}).removeAttr("disabled")}),$(this).find("input[type='text']").each(function(){$(this).attr({id:function(e,t){return Left(t,t.length-1)+parseInt(a+1)},name:function(e,t){return Left(t,t.length-1)+parseInt(a+1)}}),1<parseInt(a+1)&&$(this).attr("min",0)}),$(this).find("select").each(function(){$(this).attr({id:function(e,t){return Left(t,t.length-1)+parseInt(a+1)},name:function(e,t){return Left(t,t.length-1)+parseInt(a+1)}})}),$(this).find("small").each(function(){$(this).attr({"data-fv-for":function(e,t){return Left(t,t.length-1)+parseInt(a+1)}})})});var e=$("#searchForm .rooms > div").length;$("#searchForm input[name=rooms]").val(e),e<4&&$("#searchForm a.add").show()}function addRoom(){var a=$("#searchForm .rooms > div").length;a++;var e=$("#searchForm .rooms > div:last-child"),t=$("#searchForm .rooms > div:eq(0)").clone(!0);t.find("button").each(function(){$(this).attr({"data-field":function(e,t){return Left(t,t.length-1)+a}}).removeAttr("disabled")}),t.find("input[type='text']").each(function(){$(this).attr({id:function(e,t){return Left(t,t.length-1)+a},name:function(e,t){return Left(t,t.length-1)+a}}),1<a&&$(this).attr("min",0)}),t.find("select").each(function(){$(this).attr({id:function(e,t){return Left(t,t.length-1)+a},name:function(e,t){return Left(t,t.length-1)+a}})}),t.find("small").each(function(){$(this).attr({"data-fv-for":function(e,t){return Left(t,t.length-1)+a}})}),t.insertAfter(e);var r=$("#searchForm .rooms > div").length;$("#searchForm .rooms > div").each(function(e){$(this).find("div:eq(0) label").html("Chambre "+parseInt(e+1))}),$("#searchForm input[name=rooms]").val(r),4==r&&$("#searchForm a.add").hide(),clicChildren(),countGuest(),$("#searchForm .rooms div:first").find("div.delete-room").find("a").hide(),$("#searchForm .rooms div:gt(1)").find("div.delete-room").find("a").show(),$("#searchForm a.del").click(function(){row_id=$(this).parent().parent(),row_id.remove(),delRoom(),clicChildren(),countGuest()})}$(function(){$(".js-datepicker").datepicker({autoclose:!0,todayHighlight:!0,inputs:[$("#arrDate"),$("#depDate")],language:"fr",format:"dd/mm/yyyy",startDate:"+0d"}),$("#arrDate").datepicker({language:"fr",autoclose:!0,startDate:"+0d",todayHighlight:!0,orientation:"auto bottom",clearBtn:!0}).on("changeDate",function(e){try{d=$.fn.datepicker.DPGlobal;var t=new Date,a=new Date,r=new Date,n=(new Date,$("#arrDate").val());t=d.parseDate(n,"dd/mm/yyyy"),d.parseDate(e.date,"dd/mm/yyyy")<t&&$("#depDate").datepicker("setRange",2),t.setDate(t.getDate()+1),a=t;var o=parseInt((a.getTime()-t.getTime())/864e5);o<=1&&(o=1),$("select.nights").val(o),$("#depDate").datepicker("setStartDate",a),$("#depDate").datepicker("update",a),(r=d.parseDate(n,"dd/mm/yyyy")).setDate(r.getDate()+25),$("#depDate").datepicker("setEndDate",r);var i=a.getDate(),s=a.getMonth()+1,l=a.getFullYear();i<10&&(i="0"+i),s<10&&(s="0"+s);var c=i+"/"+s+"/"+l;$("#depDate").val(c),$("#searchForm").formValidation("revalidateField","arrDate"),$("#searchForm").formValidation("revalidateField","depDate"),$("#depDate").focus().blur()}catch(e){}}),$("#depDate").datepicker({language:"fr",autoclose:!0,startDate:"+1d",todayHighlight:!0,orientation:"auto bottom",clearBtn:!0}).on("changeDate",function(e){try{var t=$.fn.datepicker.DPGlobal,a=new Date,r=new Date;a=t.parseDate($("#arrDate").val(),"dd/mm/yyyy"),r=t.parseDate($("#depDate").val(),"dd/mm/yyyy");var n=parseInt((r.getTime()-a.getTime())/864e5);n<=1&&(n=1),$("select.nights").val(n),$("#searchForm").formValidation("revalidateField","depDate")}catch(e){}}),$("select.nights").change(function(){var e=$(this).val(),t=new Date,a=new Date;ddd=$.fn.datepicker.DPGlobal,(t=ddd.parseDate($("#arrDate").val(),"dd/mm/yyyy")).setDate(t.getDate()+parseInt(e));var r=(a=t).getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear();$("#depDate").val(r),$("#depDate").datepicker("setDate",a),$("#depDate").datepicker("update"),d3=ddd.parseDate($("#arrDate").val(),"dd/mm/yyyy"),d3.setDate(d3.getDate()+25),$("#depDate").datepicker("setEndDate",d3)}),$("#searchForm .rooms div:first").find("div.delete-room").find("a").hide(),$("#searchForm a.add").click(function(){addRoom()}),$("#searchForm .adultshotel,#searchForm .childrenhotel,#searchForm .infantshotel").bind("change",function(){countGuest()}).change(),$("#searchForm .childrenhotel").bind("change",function(){clicChildren()}).change(),$("#searchForm a.del").click(function(){$("select[id^='age_']").each(function(e){$f=$(this).attr("data-fv-field"),$f&&0!=$f&&(console.log("remove field"+$f),$("#searchForm").formValidation("removeField",$f))}),row_id=$(this).parent().parent(),row_id.remove(),delRoom(),clicChildren(),countGuest()}),$("#searchForm .guests-select").click(function(){$("#searchForm .guests").show()}),$("#searchForm .button-save, #searchForm .closef").click(function(){$("#searchForm .guests").fadeOut()});var a=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,identify:function(e){return e.name},prefetch:"/hotels/data/destinations_v2.0.json"}),e=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,initialize:!1,remote:{url:"/hotels/data/hotels.cfm?query=%QUERY&v="+versionNumber,wildcard:"%QUERY"}});$("#locality").typeahead({minLength:0,highlight:!0},{name:"destination",display:"name",limit:50,source:function(e,t){""==e?t(a.all()):a.search(e,t)},templates:{header:"<h5>Villes</h5>",suggestion:function(e){return'<div class="tt-suggest-page">'+e.name+"</div>"}}},{name:"destination",display:"name",limit:100,source:e,templates:{header:"<h5>Hotels</h5>",suggestion:function(e){return'<div class="tt-suggest-page">'+e.name+"</div>"}}}).bind("typeahead:selected",function(e,t,a){"H"==t.type?($("#destinationId").val(t.cityId),$("#hotelId").val(t.id)):$("#destinationId").val(t.id),$("#searchForm").formValidation("revalidateField","locality")}),$(".icon-close").click(function(){$("#searchForm #locality").typeahead("val",""),$(this).hide()}),$("#searchForm").formValidation({message:"Veuillez remplir ce champs",excluded:"",live:"disabled",verbose:"false",fields:{locality:{validators:{notEmpty:{message:"Veuillez remplir ce champs"}}},arrDate:{validators:{notEmpty:{message:"Veuillez remplir ce champs"}}},depDate:{validators:{notEmpty:{message:"Veuillez remplir ce champs"}}}}}).on("err.form.fv",function(e,t){$p=$("#searchForm .persons").find("[data-fv-validator][data-fv-result='INVALID']").length,0<$p&&$("#searchForm .guests").show()})});