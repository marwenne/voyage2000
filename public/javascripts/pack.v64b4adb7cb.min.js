function CurrencyFormat(e,t){switch(t){case"DZD":3<(e=(e=Math.ceil(e)).toString()).length&&(e=Left(e,e.length-3)+" "+Right(e,3));break;case"TND":e=e.toFixed(2);break;default:e=e.toFixed(2)}return e}function cancelDateFormat(e){e=(e=(e=(e=(e=e.toString().replace("GMT","")).replace("CET","")).replace("CEST","")).replace("A","T")).replace("P","T");var t=listGetAt(e,1,"T");t=listGetAt(t,3,"-")+"/"+listGetAt(t,2,"-")+"/"+listGetAt(t,1,"-");var a=listGetAt(e,2,"T");return a=(a=(a=a.replace("+","|")).replace("-","|")).replace("Z","|"),t+" "+(a=listGetAt(a,1,"|"))}var getLocalityName=function(e){var t=null;for(t=0;localitiesObj.length>t;t+=1)if(localitiesObj[t].id===e)return localitiesObj[t];return null},getAccType=function(e){var t=null;for(t=0;accObj.length>t;t+=1)if(accObj[t].id===e)return accObj[t];return null},getTheme=function(e){var t=null;for(t=0;themesObj.length>t;t+=1)if(themesObj[t].id===e)return themesObj[t];return null};$(document).ajaxStart(function(){}).ajaxStop(function(){$(".lazy").lazyload({effect:"fadeIn"}),stopSearch()}).ajaxError(function(e,t,a){throw a});var totalItems=0,filtredItems=0,numPerPage=10,searchCode="",totalPages=1,currentPage=1,hotels=new Array,minP=1,maxP=9999999,checkRooms=new Array;function startSearch(e){try{var t="https://api.voyages2000.com.tn/hotels/availability?"+e;$.ajax({type:"GET",url:t,cache:!0,beforeSend:function(){$("#loading-result").show()},success:function(e){searchCode=e.searchCode,totalItems=e.total,filtredItems=e.total,numPerPage=parseInt(e.perPage),e.total>numPerPage&&(totalPages=Math.ceil(e.total/numPerPage)),$(".total").html(totalItems),fetchResults(e),getFilters(searchCode),$("#loading-result").hide(),$(".sort select").change(function(){$("#results").empty(),getPage(searchCode,1)}),$("a.see-more-hotels").click(function(){getPage(searchCode,currentPage+1)})},error:function(e){$("#loading-result").hide(),console.log("error ajax !")},timeout:15e3})}catch(e){console.log("catch error ajax : "+e)}}function stopSearch(){1<filtredItems?$("span.txt-hotel").html("hôtels trouvés"):($("span.txt-hotel").html("hôtel trouvé"),$("a.see-more-hotels").hide()),0==totalItems||""==searchCode||void 0===searchCode?($(".no-results").css("display","block"),$(".hiddenBox").hide()):($(".no-results").css("display","none"),$(".hiddenBox").show(),$(".see-more-hotels").show()),totalPages=Math.ceil(filtredItems/numPerPage),currentPage==totalPages&&$("a.see-more-hotels").hide()}function fetchResults(e){try{$.each(e.hotels,function(e,t){addRow(t,e)}),checkRoom(),getPrice(),book(),$("a.toggle-rooms").click(function(){var t=$(this);$(this).parent().parent().find("div.item-room:gt(2)").each(function(e){$(this).is(":visible")?($(this).hide("slow"),t.html('Voir plus de chambres <i class="fas fa-chevron-circle-down pl-1"></i>')):($(this).show("slow"),t.html('Voir moins de chambres <i class="fas fa-chevron-circle-up pl-1"></i>'))})}),$('[data-toggle="tooltip"]').tooltip()}catch(e){console.log("Error fetchResults : "+e)}}function resetResults(){console.log("test reset");try{$("input.fl:checkbox:checked").each(function(e){$(this).prop("checked",!1)}),$("input[type='search'][name='words']").val(""),minP=1,maxP=9999999,$("#results").empty(),setTimeout(function(){getPage(searchCode,1)},200)}catch(e){}}var tabRm_=new Array,tabAd_=new Array,tabCh_=new Array,tabIn_=new Array;for(i_=1;i_<=rm;i_++){var ex=!1;if(0==tabRm_.length)tabAd_[1]=tabAd[i_],tabCh_[1]=tabEnf[i_],tabIn_[1]=tabInf[i_],tabRm_[1]=1;else{for(j_=1;j_<=tabRm_.length;j_++)if(tabAd[i_]==tabAd_[j_]&&tabEnf[i_]+tabInf[i_]==tabCh_[j_]+tabIn_[j_]){tabRm_[j_]=tabRm_[j_]+1,ex=!0;break}if(0==ex){var ix=tabRm_.length;tabAd_[ix]=tabAd[i_],tabCh_[ix]=tabEnf[i_],tabIn_[ix]=tabInf[i_],tabRm_[ix]=1}}}function createTempOccupArr(){var e=new Array;for(t=1;t<=tabRm_.length;t++){var a=new Array;a.push(tabRm_[t]),a.push(tabAd_[t]),a.push(tabCh_[t]),a.push(tabIn_[t]),a.push(t),e.push(a)}return e}function addRow(r,e){try{var o=createTempOccupArr();src=0<r.photos.length?r.photos[0]:"/assets/img/404.jpg",city=getLocalityName(r.cityId),dest="",dest=void 0!==r.areaId?(area=getLocalityName(r.areaId),area?area.name+", "+city.name:city.name):r.city+", "+r.address;var t,n,s=r.hotelId+"_"+e;if(t=r.name,n=CurrencyFormat(r.minRate,r.currency),totalprice=0<r.minRate?r.minRate+" "+r.currency:"N/C",html='<div class="card shadow rounded-75 mb-3 item-card-htl"><div class=" item-htl"><div class="row">',html+='<div class="col-md-3 col-5 pr-0"><figure class="position-relative mb-0"><a href="/hotels/hotel.cfm?referer=search&hotelId='+r.hotelId+'" class="link hotel" value="'+r.hotelId+'"><img src="/assets/img/tenor.gif" data-original="'+src+'" class=" lazy img-fluid h-hotel rounded-top-bottom-radius"></a></figure></div>',html+='<div class="col-md-6 col-7 box-info-htl py-3  d-md-block d-flex flex-wrap">',html+='<div class="mb-2">',html+='<h2 class="h3"><a href="/hotels/hotel.cfm?referer=search&hotelId='+r.hotelId+'" class="hotel text-dark" value="'+r.hotelId+'" >'+t+"</a></h2>",html+='<div class="mb-2">',$.isNumeric(r.rating)){for(html+='<small class="rating font-14 mr-md-1">',i=0;i<r.rating;i++)html+='<i class="fa fa-star"></i>';html+="</small>"}html+='<span class="place  text-info">',html+='<span class="me-md-2"><i class="fas fa-map-marker-alt px-1"></i>'+dest+"</span>",html+="</span>",html+="</div>",void 0!==r.themes&&0<r.themes.length&&(html+='<div class=" themes my-2 hidden-sm">',r.themes.forEach(function(e){theme=getTheme(e),html+='<span class="mr-1 mb-2 badge badge-dark-outline font-weight-500 font-12">'+theme.name+"</span> "}),html+="</div>"),0<r.marketingText.length&&(html+='<div class="text-success accroche hidden-sm  fs-sm-12"><i class="fas fa-thumbs-up pr-2"></i>'+r.marketingText+"</div>"),html+="</div>",html+='<div class="hidden-md ml-auto mt-auto">',html+='<div class="text-right text-danger">',html+='<div class="font-weight-600 font-20">'+n+" <small> "+r.currency+"</small></div>",html+="</div>",html+='<div class=" align-self-center text-right mt-3">',html+='<a class="link-search btn btn-warning rounded-25 btn-sm" data-toggle="collapse" href="#plusInfos_'+s+'" aria-expanded="false" aria-controls="plusInfos_'+s+'">Chambres & Tarifs </a>',html+="</div>",html+="</div>",html+="</div>",html+='<div class="col-md-3 align-self-center text-center hidden-sm ">',html+='<div class="mt-md-auto p-3  w-100  text-center d-flex d-md-block">',html+="<div>",html+='<div class="font-weight-600 font-14 mb-md-2  align-self-center mr-1 mr-md-0">A partir de</div>',html+='<div class="font-weight-600 font-20 mb-md-2">'+n+" <small> "+r.currency+"</small></div>",html+="</div>",html+='<div class="ml-auto align-self-center">',html+='<a class="link-search btn btn-warning rounded-25 btn-sm" data-toggle="collapse" href="#plusInfos_'+s+'" aria-expanded="false" aria-controls="plusInfos_'+s+'">Chambres & Tarifs </a>',html+="</div>",html+="</div>",html+="</div>",html+="</div>",html+='<div class="collapse mt-md-4  px-3" id="plusInfos_'+s+'">',html+='<div class="row">',html+='<div class="col-md-12">',html2='<form action="/hotels/step1.cfm" method="post">';var l=0;for(html2+='<div><div class="lstrooms">',html2+='<div class=" border-bottom border-primary px-3 py-2 hidden-sm text-info font-weight-600"><div class="row" ><div class="text-left col-md-5">Type de chambre</div><div class="col-md-2">Occupation</div><div class="col-md-3">Type de pension</div><div class="text-right col-md"> '+totnights+"</div></div></div>",i=0;i<r.rooms.length;i++){room=r.rooms[i],html2+='<div class="item-room py-2 border-bottom">',html2+='<div class="row">',iname="room_"+r.hotelId,roomId=iname+"_"+i,iname2="pensionId_"+r.hotelId;var d=room.name;if(d=d.replace(","," + "),rates=room.rates,0<rates.length){switch(roomAvail=rates[0].availability,oldprice="",0<rates[0].amountWithoutPromotion&&(amountWithoutPromotion=rates[0].amountWithoutPromotion,promtionPercentage=(amountWithoutPromotion-rates[0].amount)/amountWithoutPromotion*100,promtionPercentage=promtionPercentage.toFixed(2),amountWithoutPromotion!=rates[0].amount&&(oldprice='<div class="text-muted font-weight-normal font-14"><span class="badge badge-danger me-2">-'+promtionPercentage+"%</span><small><s>"+amountWithoutPromotion+" "+r.currency+"</s></small></div>")),roomAvail){case"S":avail="<span class='badge badge-danger'>Type de Chambre n&#039 est pas disponible durant cette p&eacute;riode</span>";break;case"A":avail="<span class='badge badge-success'>Disponible</span>";break;default:avail="<span class='badge badge-warning'>Sur demande</span>"}r1=rates[0],roomprice=0<r1.amount?r1.amount.toFixed(2)+" "+r.currency:"N/C",qte=r1.rooms,occupation="",roomAvailCount="A"==r1.availability&&r1.allotment<=5?(roomAvailCount=1==r1.allotment||0==r1.allotment?r1.allotment+" chambre":r1.allotment+" chambres","Il ne reste que "+roomAvailCount):"";var m="";for(rr=1;rr<=r1.rooms;rr++){var h=r1.adults,p=r1.children,u=r1.infant,b=room.code;for(-1!=h.toString().indexOf(",")&&(h=listGetAt(r1.adults,rr,","),p=listGetAt(r1.children,rr,","),u=listGetAt(r1.infant,rr,","),b=listGetAt(room.code,rr,",")),a=1;a<=h;a++)occupation+='<i class="fas fa-male mr-1 fa-lg"></i>';if(m+=1==h||0==h?h+" adulte ":h+" adultes ",0<p){for(m+=" + ",c=1;c<=p;c++)occupation+='<i class="fas fa-child mr-1 "></i>';m+=1==p?p+" enfant ":p+" enfants "}if(0<u){for(m+=" + ",i=1;i<=u;i++)occupation+='<i class="fas fa-baby mr-1 "></i>';m+=1==u?u+" bébé ":u+" bébés "}rr<r1.rooms&&(occupation+=" / ",m+=" / ")}roomCancelPolicies=r1.cancellationPolicies,rateDesc="","NOR"==r1.rateClass?0<roomCancelPolicies.length&&(rateDesc='<span class="text-success">Annulation gratuite avant le '+cancelDateFormat(roomCancelPolicies[0].from)+"</span>"):rateDesc="NRF"==r1.rateClass?'<span class="badge badge-danger">Non Remboursable!</span>':"SPE"==r1.rateClass?'<span class="badge badge-info">Speciale!</span>':"OFE"==r1.rateClass?'<span class="badge badge-info">Offre!</span>':r1.rateClass;var v="";for(f=0;f<roomCancelPolicies.length;f++)charges=roomCancelPolicies[f],v+="Du&nbsp;"+cancelDateFormat(charges.from)+" &nbsp; Vous serez chargé de &nbsp;"+charges.amount+" "+r.currency;var g="";0<o.length&&o.forEach(function(e){if(r1.rooms==e[0]&&h==e[1]&&p+u==e[2]+e[3]){g='checked="checked"',l=e[4],o.splice($.inArray(e,o),1);var t={roomId:b,roomSearch:l,hotelCode:r.hotelId};checkRooms.push(t)}}),html2+='<div class="col-md-5 align-self-center"><div class="mb-2"><label><input class="reltop20 " type="checkbox" index="'+l+'" roomId="'+b+'" hotelCode="'+r.hotelId+'" value="" '+g+"></label>&nbsp;&nbsp; "+qte+" x "+d+'<div class="d-inline"> '+avail+'<span class="rateDescription ml-2">'+rateDesc+"</span></div></div></div>",html2+='<div class="col-md-2 align-self-center"><span data-toggle="tooltip" style="cursor:pointer;" title="'+m+'">'+occupation+"</span></div>",html2+='<div class="col-md-3 col-7 align-self-center"><select class="form-control font-14 pensionId" name="'+iname2+'">',$.each(room.rates,function(e,t){html2+='<option value="'+encodeURIComponent(JSON.stringify(t))+'">'+t.boardName+"</option>"}),html2+="</select></div>",html2+='<div class="text-right col-md-2 col-5 price font-18 align-self-center" value="'+r1.amount.toFixed(2)+'">'+oldprice+roomprice+"</div>",html2+='<div class="col-md-6 align-self-center mb-3">',html2+='<div class="font-weight-500 text-danger">'+roomAvailCount+"</div>",html2+="</div>",html2+='<div class="col-md-6 align-self-center text-right mb-3">',html2+='<div class="font-weight-500"><div><a class="text-success cancelCharges" data-toggle="tooltip" title="'+v+'" data-placement="bottom"><u> Frais d\'annulation</u></a></div></div>',html2+="</div>"}else html2+='<div class="col-md-12 font-12">Pas de tarifs disponibles qui correspondent à votre critère de recherche</div>';html2+="</div>",html2+="</div>"}4<r.rooms.length&&(html2+='<div class=" text-center bg-light py-2"><a href="javascript:void(0)" class="toggle-rooms text-secondary text-uppercase font-weight-600"><u>Voir plus de chambres </u><i class="fas fa-angle-double-down ps-1"></i></a></div>'),html2+='<div class="tfoot border-top border-primary  py-3 ">',html2+='<div class="lstsupp row "><div class=" col-md-10 text-right font-weight-600"><label>Montant total du séjour : </label><span class="font-22 ml-3"></span></div>',html2+='<div class="text-right col-md-2"><button type="button" value="'+r.hotelId+'" class="btn btn-primary  rounded-25 book">R&eacute;server</button></div>',html2+="</div>",html2+="</div></div>",html2+="</form>",html2+="</div>",html2+="</div>",html2+="</div>",html+=html2,html+="</div>",html+="</div></div></div>",$("#results").append(html)}catch(e){console.log("Error addRow "+e)}}function getIndexRoomId(e,a,r,o){var n=-1;return $.each(e,function(e,t){"roomSearch"==r?t.hotelCode==o&&t.roomSearch==a&&(n=e):t.hotelCode==o&&t.roomId==a&&(n=e)}),n}function checkPax(e){var t=new Array,a=-1;t[0]=e.rooms,t[1]=e.adults,t[2]=e.children,t[3]=e.infant;var o=t[1];for(r=1;r<=rm;r++)if(-1!=o.toString().indexOf(",")&&(t[1]=listGetAt(e.adults,r,","),t[2]=listGetAt(e.children,r,","),t[3]=listGetAt(e.infant,r,",")),0==t[3]&t[2]-tabEnf[r]==tabInf[r]&&(t[3]=t[2]-tabEnf[r],t[2]=t[2]-tabInf[r]),t[1]==tabAd[r]&t[2]==tabEnf[r]&t[3]==tabInf[r]){a=r;break}return a}function checkRoom(){var n="";$(".lstrooms").find("input[type=checkbox]").change(function(){var a=$(this),r=$(this).attr("hotelCode");if($(a).is(":checked")){var o;if(n=a.attr("roomId"),rate=a.parent().parent().parent().parent().find("select.pensionId"),index=$(rate).find("option:selected").index(),objRoom=$(rate).find("option:eq("+index+")").val(),pensions=$.parseJSON(decodeURIComponent(objRoom)),qte=pensions.rooms,o=checkPax(pensions),$(this).attr("index",o),exist=!1,-1<getIndexRoomId(checkRooms,o,"roomSearch",r)&&(exist=!0),-1<o&&checkRooms.length<rm&&0==exist){var e={roomId:n,roomSearch:o,hotelCode:r};checkRooms.push(e)}else for(c=0;c<checkRooms.length;c++)roomIdCheck=checkRooms[c].roomId,roomSearch=checkRooms[c].roomSearch,o==roomSearch&&$(".lstrooms").find("input:checkbox:checked").each(function(){var e=$(this);if(roomcodeCheked=e.attr("roomId"),roomCheckedIndex=e.attr("index"),hotelCodeChecked=e.attr("hotelCode"),n!=roomcodeCheked&&roomCheckedIndex==o&&hotelCodeChecked==r){e.prop("checked",!1),n=a.attr("roomId"),checkRooms.splice(c,1);var t={roomId:n,roomSearch:o,hotelCode:r};checkRooms.push(t)}})}else a=$(this),n=a.attr("roomId"),index=getIndexRoomId(checkRooms,n,"roomId",r),-1<index&&checkRooms.splice(index,1)})}function getFilters(s){try{var e="https://api.voyages2000.com.tn/hotels/filters/"+s;$.ajax({type:"GET",url:e,cache:!0,beforeSend:function(){},success:function(a){if("success"==a.status){$(".fl-budget1").find("span.minP").html(a.minRate.toFixed(2)+" "+currency),$(".fl-budget1").find("span.maxP").html(a.maxRate.toFixed(2)+" "+currency);var r="";$.each(a.boards,function(e,t){$.isNumeric(t.code)?r+='<div class="custom-control custom-checkbox mb-1"><input type="checkbox" id="board_'+t.code+'"  name="boards" class="fl custom-control-input" value="'+t.code+'"><label class="custom-control-label" for="board_'+t.code+'">'+t.name+"</label></div></div>":r+='<div class="custom-control custom-checkbox mb-1"><input type="checkbox" id="board_0" name="boards" class="fl custom-control-input" value="0"><label class="custom-control-label" for="board_0">Indiff</label></div></div>'}),$(".fl-boards").html(r);var o="";$.each(a.ratings,function(e,t){$.isNumeric(t.code)?o+='<div class="custom-control custom-checkbox mb-1"><input type="checkbox" id="rating_'+t.code+'"  name="rating" class="fl custom-control-input" value="'+t.code+'"><label class="custom-control-label" for="rating_'+t.code+'">'+t.name+"</label></div></div>":o+='<div class="custom-control custom-checkbox  mb-1"><input type="checkbox" id="rating_0"  name="rating" class="fl custom-control-input" value="0"><label class="custom-control-label" for="rating_0">Indiff</label></div></div>'}),$(".fl-rating").html(o);var n="";$.each(a.themes,function(e,t){$.isNumeric(t.code)?n+='<div class="custom-control custom-checkbox mb-1"><input type="checkbox" id="theme_'+t.code+'"  name="themes" class="fl custom-control-input" value="'+t.code+'"><label class="custom-control-label" for="theme_'+t.code+'">'+t.name+"</label></div></div>":n+='<div class="custom-control custom-checkbox mb-1"><input type="checkbox" id="theme_0" name="themes" class="fl custom-control-input" value="0"><label class="custom-control-label" for="theme_0">Indiff</label></div></div>'}),$(".fl-themes").html(n),$(".fl").click(function(e){v=$(this).val(),$("#results").empty(),getPage(s,1)}),$(".slider").slider({min:a.minRate,max:a.maxRate,value:a.maxRate,step:.5,tooltip:"hide"}).on("slideStop",function(e){var t=$("#customRange11");minP=a.minRate,maxP=parseFloat(e.value),$("#customRange11").change(function(){$(".fl-budget1").find("span.maxP").html(t.val()+" "+currency)}),$("#results").empty(),getPage(s,1)}),$(".slider").css("width","95%"),$("button.reset").click(function(){resetResults()})}},error:function(e){console.log("Error getFilters : "+e)},timeout:2e3})}catch(e){console.log("ERROR getFilters "+e)}}function getPage(e,t){try{var a="https://api.voyages2000.com.tn/hotels/page/"+t+"/"+e+"?1=1",r=$("input[type='search'][name='words']").val().toLowerCase();2<r.length&&(a+="&words="+r);var o=[];$("input[type='checkbox'][name='rating']:checked").each(function(){o.push($(this).val())}),0<o.length&&(a+="&rating="+o);var n=[];$("input[type='checkbox'][name='boards']:checked").each(function(){n.push($(this).val())}),0<n.length&&(a+="&boards="+n);var s=[];$("input[type='checkbox'][name='themes']:checked").each(function(){s.push($(this).val())}),0<s.length&&(a+="&themes="+s);var l=[];$("input[type='checkbox'][name='popular']:checked").each(function(){l.push($(this).val())}),0<l.length&&(a+="&popular="+l);var i=[];$("input[type='checkbox'][name='budgets']:checked").each(function(){i.push($(this).val())}),0<i.length&&(a+="&budgets="+i),a+="&minP="+minP,a+="&maxP="+maxP,a+="&sort="+$(".sort select").val(),$.ajax({type:"GET",url:a,cache:!0,beforeSend:function(){},success:function(e){filtredItems=e.total,$(".total").html(filtredItems),currentPage=t,fetchResults(e)},error:function(e){},timeout:2e3})}catch(e){}}function getPrice(){try{$(".lstrooms").find("input:checked").each(function(){e=$(this),total=0,e.parent().parent().parent().parent().parent().parent().find(".price").removeClass("selected"),e.parent().parent().parent().parent().parent().parent().find("input:checkbox").each(function(){var e=$(this);e.is(":checked")&&e.parent().parent().parent().parent().find(".price").addClass("selected")}),e.parent().parent().parent().parent().parent().parent().find("input:checkbox:checked").each(function(){v=$(this).parent().parent().parent().parent().find("select").val(),obj=$.parseJSON(decodeURIComponent(v)),total=parseFloat(total)+parseFloat(obj.amount)}),0<total?(e.parent().parent().parent().parent().parent().parent().parent().find(".tfoot span:eq(0)").html(CurrencyFormat(total,currency)+" "+currency).fadeOut("slow").fadeIn("slow"),e.parent().parent().parent().parent().parent().parent().parent().find(".tfoot button").removeAttr("disabled"),e.parent().parent().parent().parent().parent().parent().parent().find(".tfoot label").show()):(e.parent().parent().parent().parent().parent().parent().parent().find(".tfoot span:eq(0)").html(""),e.parent().parent().parent().parent().parent().parent().parent().find(".tfoot button").attr("disabled","disabled"),e.parent().parent().parent().parent().parent().parent().parent().find(".tfoot label").hide())}),$(".lstrooms").find("input:checkbox").change(function(){e=$(this),total=0,e.parent().parent().parent().parent().parent().parent().find(".price").removeClass("selected"),e.parent().parent().parent().parent().parent().parent().find("input:checkbox").each(function(){var e=$(this);e.is(":checked")&&e.parent().parent().parent().parent().find(".price").addClass("selected")}),e.parent().parent().parent().parent().parent().parent().find("input:checkbox:checked").each(function(){v=$(this).parent().parent().parent().parent().find("select").val(),obj=$.parseJSON(decodeURIComponent(v)),total=parseFloat(total)+parseFloat(obj.amount)}),0<total?(e.parent().parent().parent().parent().parent().parent().parent().find(".tfoot span:eq(0)").html(CurrencyFormat(total,currency)+" "+currency).fadeOut("slow").fadeIn("slow"),e.parent().parent().parent().parent().parent().parent().parent().find(".tfoot button").removeAttr("disabled"),e.parent().parent().parent().parent().parent().parent().parent().find(".tfoot label").show()):(e.parent().parent().parent().parent().parent().parent().parent().find(".tfoot span:eq(0)").html(""),e.parent().parent().parent().parent().parent().parent().parent().find(".tfoot button").attr("disabled","disabled"),e.parent().parent().parent().parent().parent().parent().parent().find(".tfoot label").hide())}),$("select.pensionId").change(function(){e=$(this);var a=e.val(),t=$.parseJSON(decodeURIComponent(a)),r=t.availability;r="A"==r?(avail="primary","Disponible"):"S"==r?(avail="danger","Type de Chambre n&#039 est pas disponible durant cette p&eacute;riode"):(avail="success","Sur demande"),e.parent().parent().parent().find("span.badge").html(r);var o="",n=0;if(0<t.amountWithoutPromotion){var s=t.amountWithoutPromotion;0<(n=(s-t.amount)/s*100)&&(o='<div class="text-muted font-weight-normal font-14"><span class="badge badge-danger me-2">-'+n.toFixed(2)+"%</span><small><s>"+s.toFixed(2)+" "+currency+"</s></small></div>")}e.parent().next().attr("value",t.amount.toFixed(2)),e.parent().next().html(0<t.amount.toFixed(2)?o+t.amount.toFixed(2)+" "+currency:"N/C"),total=0,e.parent().parent().parent().parent().find(".price.selected").each(function(e,t){a=$(this).attr("value"),a=parseFloat(a),total+=a}),0<total?e.parent().parent().parent().parent().parent().parent().parent().find(".tfoot span:eq(0)").html(CurrencyFormat(total,currency)+" "+currency).fadeOut("slow").fadeIn("slow"):e.parent().parent().parent().parent().parent().parent().parent().find(".tfoot span:eq(0)").html("");var l=t.cancellationPolicies,i="";for(f=0;f<l.length;f++)charges=l[f],i+="Du "+cancelDateFormat(charges.from)+" Vous serez chargé de "+charges.amount+" "+currency;var c=e.parent().parent().parent().find("a.cancelCharges");c.attr("title",i),c.attr("data-original-title",i),rateDesc="","NOR"==t.rateClass?0<l.length&&(rateDesc='<span class="text-success">Annulation gratuite avant le '+cancelDateFormat(l[0].from)+"</span>"):rateDesc="NRF"==r1.rateClass?'<span class="badge badge-danger">Non Remboursable!</span>':"SPE"==t.rateClass?'<span class="badge badge-info">Speciale!</span>':"OFE"==t.rateClass?'<span class="badge badge-info">Offre!</span>':t.rateClass,e.parent().parent().parent().find("span.rateDescription").html(rateDesc)})}catch(e){console.log("getPrice "+e)}}function book(){$("button.book").click(function(t){var n=[],s=new Array,l=new Array;if($(this).parent().parent().parent().parent().find("input:checked").each(function(){e=$(this),sel=e.parent().parent().parent().parent().find("select.pensionId"),index=$(sel).find("option:selected").index(),objRoom=$(sel).find("option:eq("+index+")").val(),rates=$.parseJSON(decodeURIComponent(objRoom));var t={rateKey:rates.rateKey};n.push(t);var a=new Array;a[0]=rates.rooms,a[1]=rates.adults,a[2]=rates.children,a[3]=rates.infant;var o=rates.adults;for(q=0;q<a[0];q++)for(s.push(1),r=1;r<=rm;r++)if(-1!=o.toString().indexOf(",")&&(a[1]=listGetAt(rates.adults,r,","),a[2]=listGetAt(rates.children,r,","),a[3]=listGetAt(rates.infant,r,",")),-1==l.indexOf(r)&&(0==a[3]&a[2]-tabEnf[r]==tabInf[r]&&(a[3]=a[2]-tabEnf[r],a[2]=a[2]-tabInf[r]),console.log(tabAd[r]+"=="+a[1]),a[1]==tabAd[r]&a[2]==tabEnf[r]&a[3]==tabInf[r])){l.push(r);break}}),s.length==rm&&l.length==rm){var a={rooms:n,searchCode:searchCode};f=$("<form/>").attr("action","/hotels/step1.cfm").attr("method","post"),f.append($("<input>").attr({type:"hidden",name:"requestData",value:JSON.stringify(a)})),t.preventDefault(),$(f).clone().appendTo("body").submit()}else Swal.fire('<span class="font-20">Nombres des chambres ne correspond pas a votre sélection initiale!!!!</span>')})}